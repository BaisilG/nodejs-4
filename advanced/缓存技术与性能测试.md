<!--
$theme: gaia
template: gaia
-->


Node.js进阶
缓存技术<p style="text-align:right;font-size:28px;margin-right:50px;color:#cFc;">:star: by calidion</p>
===

---
缓存技术的作用
===
主要作用是提升系统的性能。
任何多级系统都会使用到缓存技术，以加速系统性能。
比如CPU与内存，硬盘，网络IO。

---
Web服务器缓存
===
对于Web开发者来说，主要关心的缓存技术是服务器缓存技术。
服务器缓存，主要缓存以下几类数据：
1. session信息
2. 经常访问的html静态页面
3. 缓存固定或者基本不变化的常量数据。比如pi，分类信息，行政区划等
4. 缓存用户信息

---
常见的缓存服务器
===
1. [redis](https://redis.io)
2. [memchached](https://memcached.org/)

---
redis
===

1. 开源
2. 内存数据结构存储
3. 可以当成是数据库，缓存，或者消息中介
4. 支持字符，哈希，列表，集合，排序的集合，图片，地理信息，超级日志等类型的数据
5. 内建对集群的支持
6. 支持永久存储

---
安装redis
===
Ubuntu:
```
sudo apt-get install redis-server
```
通过
```
dpkg -L redis-server
```
可以查看安装的文件

---
连接到redis服务器
===
1. 执行命令行工具redis-cli
```
$ redis-cli 
127.0.0.1:6379> 
```
其中6379是redis服务器的默认端口号
2. 测试连接性
```
127.0.0.1:6379> ping
PONG
```
返回PONG表示服务器是正常能连接的。

---
redis配置信息
===
1. 查看所有配置信息

```
127.0.0.1:6379> CONFIG GET *
```

这时会返回所有的配置信息。

2. 查看具体的配置信息

如果你感觉所有配置太多，太乱。可以选择一个配置进行查看
```
127.0.0.1:6379> CONFIG GET 'dbfilename'
1) "dbfilename"
2) "dump.rdb"
```
3. 设置配置信息

格式：
```
127.0.0.1:6379> CONFIG SET <key, value>

```
示例：
```
127.0.0.1:6379> CONFIG SET loglevel 'notice'
OK
```
---
重要配置参数说明
===
1. maxclients 最多客户连接数

设置 maxclients 0，表示不作限制

```
CONFIG GET 'maxclients'
1) "maxclients"
2) "10000"
```
---
2. maxmemory 最大允许内存
当内存超出后，如果启动了vm，数据将会被保存在swap中，但key仍保存在内存里。

```
CONFIG GET 'maxmemory'
1) "maxmemory"
2) "0"
```

---

3. requirepass 服务器的密码

```
127.0.0.1:6379> CONFIG GET 'requirepass'
1) "requirepass"
2) ""
```

---

4. port 服务器的端口

默认端口为6379

```
127.0.0.1:6379> CONFIG GET 'port'
1) "port"
2) "6379"
```

---
5. bind 服务器的绑定IP

默认是127.0.0.1
```
127.0.0.1:6379> CONFIG GET 'bind'
1) "bind"
2) "127.0.0.1"
```

---
6. save 保存频率
指代保存被触发的条件，默认有三个：
1. 900 1 表示900秒里1次操作，会保存
2. 300 1 表示300秒里10次操作，会保存
3. 60 10000 表示60秒里执行了10000次操作，会保存

也就是更新频率越快，保存的越频繁。

```
127.0.0.1:6379> CONFIG GET 'save'
1) "save"
2) "900 1 300 10 60 10000"
```
---
缓存数据
===

1. 字符串
格式: 
a. 设置: SET <key, value>
b. 获取: GET <key, value>

key区分大小写

```
127.0.0.1:6379> SET name 'hello'
OK
127.0.0.1:6379> GET name
"hello"
127.0.0.1:6379> GET Name
(nil)
```
---

2. 哈希数据

格式:
a. 设置 HMSET key <subkey, value> <subkey, value>
b. 获取 HGETALL key
b. 获取 HGET key <subkey>
```
127.0.0.1:6379> HMSET a a 1 b 2
OK
127.0.0.1:6379> HGETALL a
1) "a"
2) "1"
3) "b"
4) "2"
127.0.0.1:6379> HGET a
(error) ERR wrong number of arguments for 'hget' command
127.0.0.1:6379> HGET a a
"1"
```
---


